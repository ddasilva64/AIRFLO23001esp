## Metrics  

### **_KPIs proposed into BSC_**  

| KPI                           | Meaning                                                                                                           |
| :---------------------------- | :---------------------------------------------------------------------------------------------------------------- |
| **_Average deal size_**       | Our company’s total revenue divided by the number of deals closed in a month, quarter, or year.                  |
| **_Win rate_**                | The number of deals won versus the number of deals lost.                                                         |
| **_Quota setting calculator_**| On-target earnings (OTE) multiplied by forecast factor. |
| **_Customer lifetime value (CLV)_** | Average by month or annual revenue per customer divided by the average lifetime of a customer. It is really the same KPI as the LTV, although the LTV would refer to all clients and the CLV to each one of the clients.  |
| **_Revenue by product_**      | Amount of income generated per product.                                   |
| **_Customer retention rate_** | The percentage of customers who stay with our business.                                                          | 
| **_Revenue churn_**           | The amount of revenue that is lost in a month, quarter, or year.                                                 |

<p><br></p> 

**_Warnings!_**: 

- In the **_DimPromotions_** table, there are 16 records:

![DimPromotions](https://i.imgur.com/zo0a9GL.png)

1. 1 record (**_6.25%_**) corresponds to sales without discounts. All sales made to customers are without discounts. This is very concerning and indicates that **_Adventure Works Cycles, Inc._** has not made any efforts to promote its sales to customers, while the competition continues to do so. The **_Board of Directors of Adventure Works Cycles, Inc. commits to exponentially increasing promotions to customers, especially in the ISS_** (International Sales Segment).
2. 13 records (**_81.25%_**) are related to resellers, and of these, 3 records (**_23.08%_**) correspond to promotions **_due to excess inventory_**. This is a serious mistake, as manufacturing to stock instead of on-demand increases expenses without boosting income. **_The Board of Directors of Adventure Works Cycles, Inc. commits to immediately designing a three-year plan to completely eliminate stock of their products and only manufacture on-demand_**, following a just-in-time approach.
- There is no relevant data related to promotions for customers, as the business is primarily oriented towards resellers. It is strongly advised that **_Adventure Works Cycles, Inc._** changes its business model to increase sales to customers significantly, while still maintaining sales to resellers, especially through the **_ISS_**. The **_Board of Directors of Adventure Works Cycles, Inc. commits to designing a three-year plan to ensure that 80% of their customers are end consumers_**, which will require exploring new markets. Currently, sales are only made to **_UK, France, and Germany within the EU_**.
- We cannot make any assurances about customer retention since there have been no subscription sales in the **_ISS_** until now. As previously mentioned, the **_Board of Directors of Adventure Works Cycles, Inc. commits to changing the functioning of this subsystem_**.
- Due to the same reasons as with customer retention, we cannot determine if we are losing customers. **_We can only measure sales within a specific period_**.
- We will check the quota setting in forecasting.
- LTV and CLV KPIs:
1. CLV is for each client, but LTV is for all the clients.
2. Para contrastar con el datos de los ingresos anuales (antes mencionado), hemos calculado el CLV en la vista CLV_view.
3. CLV y LTV dependerán de la dimensión del tiempo en el BSC y se deberán calcular dinámicamente (sobre la misma vista).

- **_LTV and CLV KPIs_**:
1. **_CLV_** (Customer Lifetime Value): CLV represents the total revenue a business can expect from **_a specific customer_** over their entire relationship with the company. It helps us identify high-value customers and focus on retaining them.
2. **_LTV_** (Lifetime Value): **_LTV_**, on the other hand, refers to the total revenue generated by **_all customers_** during their entire relationship with the company. It provides a broader perspective on the overall value of the customer base.
3. **_Data analysis_**: To analyze these KPIs, we worked with the view **_CLV\_view_** in **_DWH_**.
4. Calculating CLV: To contrast with the annual customer income data (mentioned above), we have calculated the **_CLV_** in the **_CLV\_view_**. The **_CLV\_view_** will give us insights into **_individual customer value_**.
5. **_Importance of time dimension_**: Both **_CLV_** and **_LTV_** are heavily influenced by the dimension of time in the **_BSC_**. It's crucial to calculate these metrics dynamically, on the same view, to get an accurate representation of customer value.
6. **_Conclusion_**: In conclusion, **_CLV_** and **_LTV_** are vital **_KPIs_** for any business looking **_to understand customer value and make data-driven decisions_**. By analyzing these metrics, **_we can focus on high-value customers_**, improve customer retention strategies, and drive business growth.
- In the **_Revenue by Product (RBP)_** KPI:
1. We have found in **_DimProduct_**, safety stocks of 1,000 units and at the reorder point 750 units. **_We repeat again_** that, without any discussion, **_we have to reduce the stocks to 0_**.
2. **_Start date, end date and status have no sense_**. The **_Board of Directors_** acknowledges this mistake and commits to Production Management to delete start and end date from Database, and to control product status.
3. Now **_it is impossible to calculate the Marginal Revenue Product (MRP)_**, because it goes to stock, and **_we must make it tend to 0_**. Marginal revenue product (MRP) is the marginal revenue created by using one additional unit of resource.
4. Similarly to **_CLV\_view_** we build a **_RBP\_view_**.
5. To calculate **_RBP_** we need the stock cost of the product. **_Adventure Works Cycles, Inc._**, cannot calculate, we assume 25.0 USD.

<p><br></p> 

````SQL
CREATE VIEW target."CLV_view"  AS 
	SELECT
       COUNT(*), c."CustomerKey", MIN(c."GeographyKey") "GeographyKey", MIN(s."CurrencyKey") "CurrencyKey",
	   MIN(s."SalesTerritoryKey") "SalesTerritoryKey",
	   MIN(c."Title") "Title", MIN(c."FirstName") "FirstName", MIN(c."MiddleName") "MiddleName", MIN(c."LastName") "LastName",
	   MIN(s."OrderDate") "MinOrderDate", MAX(s."OrderDate") "MaxOrderDate",
	   target."NetIncomeFunc"(SUM(s."ExtendedAmount"),SUM(s."ProductStandardCost"),SUM(s."TaxAmt"),SUM(s."Freight")) "NetIncome",
	   CASE 
			WHEN target."NetIncomeFunc"(SUM(s."ExtendedAmount"),SUM(s."ProductStandardCost"),SUM(s."TaxAmt"),SUM(s."Freight")) > 0 THEN 1
	   ELSE 0
	   END "ARPA_Account",
	   target."MonthsFunc"(
				DATE_PART('YEAR',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))),
				DATE_PART('MONTH',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))),
		   		DATE_PART('DAY',AGE(MAX(s."OrderDate"), MIN(s."OrderDate")))
		   		) "MonthsNo",
	   target."CLVFunc"(
		   		SUM(s."ExtendedAmount"),SUM(s."ProductStandardCost"),SUM(s."TaxAmt"),SUM(s."Freight"),
				DATE_PART('YEAR',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))),
				DATE_PART('MONTH',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))),
		   		DATE_PART('DAY',AGE(MAX(s."OrderDate"), MIN(s."OrderDate")))
		   		) "CLV",
	   10.00 "CAC",
	   target."CLV_CACFunc"(
			SUM(s."ExtendedAmount"),SUM(s."ProductStandardCost"),SUM(s."TaxAmt"),SUM(s."Freight"),
			DATE_PART('YEAR',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))),
			DATE_PART('MONTH',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))),
			DATE_PART('DAY',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))), 10.0
			) "CLV_CAC",
	   MIN("BirthDate") "BirthDate", DATE_PART('year',AGE("BirthDate")) "Age", 
	   MIN("MaritalStatus") "MaritalStatus", min("Suffix") "Suffix", 
	   MIN("Gender") "Gender", min("YearlyIncome") "YearlyIncome", 
	   MIN("TotalChildren") "TotalChildren", MIN("NumberChildrenAtHome") "NumberChildrenAtHome", 
	   MIN("Education") "Education", MIN("HouseOwnerFlag") "HouseOwnerFlag", MIN("NumberCarsOwned") "NumberCarsOwned", 
	   MIN("AddressLine1") "AddressLine1", MIN("AddressLine2") "AddressLine2", 
	   MIN("Phone") "Phone", MIN("DateFirstPurchase") "DateFirstPurchase", MIN("CommuteDistance") "CommuteDistance", 
	   MIN("Occupation") "Occupation"
 	FROM target."DimCustomer" c 
      LEFT JOIN target."FactInternetSales" s
	  ON s."CustomerKey" = c."CustomerKey"
	GROUP BY c."CustomerKey";
````

````SQL
CREATE OR REPLACE FUNCTION target."MonthsFunc" (double precision,double precision,double precision) RETURNS int AS '
	DECLARE
		yearsNo 			ALIAS FOR $1;
		monthsNo			ALIAS FOR $2;
		daysNo 				ALIAS FOR $3;
	BEGIN
		RETURN 
			CASE WHEN yearsNo*12 + monthsNo + CEIL(daysNo/28)>0 THEN yearsNo*12 + monthsNo + CEIL(daysNo/28)
			ELSE 1
            END;
	END;
' LANGUAGE 'plpgsql';
````

````SQL
CREATE OR REPLACE FUNCTION target."CLVFunc" (double precision, double precision, double precision, double precision,double precision,double precision,double precision) RETURNS double precision AS '
	DECLARE
		ExtendedAmount 		ALIAS FOR $1;
		ProductStandardCost ALIAS FOR $2;
		TaxAmt 				ALIAS FOR $3;
		Freight				ALIAS FOR $4;
		yearsNo 			ALIAS FOR $5;
		monthsNo			ALIAS FOR $6;
		daysNo 				ALIAS FOR $7;
	BEGIN
	    RETURN target."NetIncomeFunc"(ExtendedAmount,ProductStandardCost,TaxAmt,Freight)/target."MonthsFunc"(yearsNo,monthsNo,daysNo);
	END;
' LANGUAGE 'plpgsql';
````

````SQL
CREATE OR REPLACE FUNCTION target."CLV_CACFunc" (double precision, double precision, double precision, double precision,
                                                 double precision, double precision, double precision, double precision) RETURNS double precision AS '
	DECLARE
		ExtendedAmount 		ALIAS FOR $1;
		ProductStandardCost ALIAS FOR $2;
		TaxAmt 				ALIAS FOR $3;
		Freight				ALIAS FOR $4;
		yearsNo 			ALIAS FOR $5;
		monthsNo			ALIAS FOR $6;
		daysNo 				ALIAS FOR $7;
		cac					ALIAS FOR $8;
	BEGIN
	    RETURN target."LTVFunc"(ExtendedAmount,ProductStandardCost,TaxAmt,Freight,yearsNo,monthsNo,daysNo)/cac;
	END;
' LANGUAGE 'plpgsql';
````

````SQL 
CREATE VIEW target."RPB_view"  AS 
	SELECT
       COUNT(*), p."ProductKey", MIN(s."CurrencyKey") "CurrencyKey",
	   MIN(s."SalesTerritoryKey") "SalesTerritoryKey",
	   MIN(p."ProductName") "ProductName", MIN(p."Description") "Description", MIN(p."ProductSubcategoryKey") "ProductSubcategoryKey", 
	   MIN(p."StandardCost") "StandardCost", MIN(p."SafetyStockLevel") "SafetyStockLevel", MIN(p."ReorderPoint") "ReorderPoint",
	   MIN(p."ListPrice") "ListPrice", MIN("StartDate") "StartDate", MIN("EndDate") "EndDate", MIN("Status") "Status",
	   MIN(s."OrderDate") "MinOrderDate", MAX(s."OrderDate") "MaxOrderDate",
	   target."NetIncomeFunc"(SUM(s."ExtendedAmount"),SUM(s."ProductStandardCost"),SUM(s."TaxAmt"),SUM(s."Freight")) "NetIncome",
	   CASE 
			WHEN target."NetIncomeFunc"(SUM(s."ExtendedAmount"),SUM(s."ProductStandardCost"),SUM(s."TaxAmt"),SUM(s."Freight")) > 0 THEN 1
	   ELSE 0
	   END "ARPP_Product",
	   target."MonthsFunc"(
				DATE_PART('YEAR',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))),
				DATE_PART('MONTH',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))),
		   		DATE_PART('DAY',AGE(MAX(s."OrderDate"), MIN(s."OrderDate")))
		   		) "MonthsNo",
	   target."CLVFunc"(
		   		SUM(s."ExtendedAmount"),SUM(s."ProductStandardCost"),SUM(s."TaxAmt"),SUM(s."Freight"),
				DATE_PART('YEAR',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))),
				DATE_PART('MONTH',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))),
		   		DATE_PART('DAY',AGE(MAX(s."OrderDate"), MIN(s."OrderDate")))
		   		) "PLV",
	   25.00 "PSC",
	   target."CLV_CACFunc"(
			SUM(s."ExtendedAmount"),SUM(s."ProductStandardCost"),SUM(s."TaxAmt"),SUM(s."Freight"),
			DATE_PART('YEAR',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))),
			DATE_PART('MONTH',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))),
			DATE_PART('DAY',AGE(MAX(s."OrderDate"), MIN(s."OrderDate"))), 25.0
			) "PLV_PSC"
 	FROM target."DimProduct" p
      LEFT JOIN target."FactInternetSales" s
	  ON s."ProductKey" = p."ProductKey"
	GROUP BY p."ProductKey";
````

<p><br></p> 

[Disclaimer](../DISCLAIMER.md)

<p><br></p> 

[ChatGPT usage](../CHATGPT_USAGE.md)  

<p><br></p>

[Metrics:arrow_up:](metrics.md)  

[Back to Table of contents :arrow_double_up:](../README.md)